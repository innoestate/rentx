<div class="table-component">
  <div class="container">
    <div class="header">
      <button nz-button nzType="default" (click)="openCreatePropspectionPopup()">Ajouter un bien en prospection</button>
      <button nz-button nzType="default" (click)="openCreateSellerPopup()">Ajouter un vendeur / agent</button>
    </div>
    <div class="table-container">

      <nz-table #tables [nzData]="prospections()">
        <thead>
          <tr>
            <th>ville</th>
            <th>adresse</th>
            <th>lien</th>
            <th>vendeur</th>
            <th>prix</th>
            <th>parution</th>
            <th>loyers</th>
            <th>status</th>
            <th>actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let prospection of tables.data">
            <td>{{prospection.city}}</td>

            <td class="editable-cell-number clickable field-medium"
              (click)="startEdit(prospection.id! + 'address', editableAddressInput)">
              <div [hidden]="editId === prospection.id + 'address'">{{prospection.address}}</div>
              <input nz-demo-input-text-basic #editableAddressInput [value]="prospection.address"
                [hidden]="editId !== prospection.id + 'address'" type="text" (blur)="stopEdit()"
                (change)="edit(prospection, 'address', editableAddressInput)" />
            </td>

            <td class="editable-cell-number clickable field-medium"
              (click)="startEdit(prospection.id! + 'link', editableLinkInput)">
              <div [hidden]="editId === prospection.id + 'link'">{{prospection.link}}</div>
              <input nz-demo-input-text-basic #editableLinkInput [value]="prospection.link"
                [hidden]="editId !== prospection.id + 'link'" type="text" (blur)="stopEdit()"
                (change)="edit(prospection, 'link', editableLinkInput)" />
            </td>

            <td><sellers-cell [prospection]="prospection"></sellers-cell></td>

            <td class="editable-cell-number clickable"
              (click)="startEdit(prospection.id! + 'price', editablePriceInput)">
              <div [hidden]="editId === prospection.id + 'price'">{{prospection.price}}</div>
              <input nz-demo-input-text-basic #editablePriceInput [value]="prospection.price"
                [hidden]="editId !== prospection.id + 'price'" type="number" (blur)="stopEdit()"
                (change)="edit(prospection, 'price', editablePriceInput)" />
            </td>

            <td>{{prospection.emission_date | date:'dd/MM/YYYY'}}</td>

            <td class="editable-cell-number clickable" (click)="startEdit(prospection.id! + 'rents', editablRentInput)">
              <div [hidden]="editId === prospection.id + 'rents'">{{prospection.rents}}</div>
              <input nz-demo-input-text-basic #editablRentInput [value]="prospection.rents"
                [hidden]="editId !== prospection.id + 'rents'" type="number" (blur)="stopEdit()"
                (change)="edit(prospection, 'rents', editablRentInput)" />
            </td>

            <td>
                @if(prospection.status){
                  <div nz-dropdown [nzDropdownMenu]="prospectionStatus" [nzTrigger]="'click'"  class="status clickable" [style]="{'background-color': prospection.statusObject?.color}">{{prospection.statusObject?.shortLabel}}<div nz-icon [nzType]="prospection.statusObject?.icon!" [nzTheme]="prospection.statusObject?.iconTheme!"></div></div>
                }@else{
                  <div nz-dropdown [nzDropdownMenu]="prospectionStatus" [nzTrigger]="'click'"  class="empty-field clickable">+</div>
                }
            </td>

            <td>
              <div class="action">
                <div nz-dropdown [nzDropdownMenu]="actionsDropdown" nz-icon nzType="tool" class="tool" nzTheme="fill">
                </div>
                <nz-dropdown-menu #actionsDropdown>
                  <ul nz-menu>
                    <li nz-menu-item (click)="remove(prospection)">
                      <div class="dropdown-item">
                        <div>Supprimer</div>
                        <i nz-icon nzType="delete" nzTheme="fill"></i>
                      </div>
                    </li>
                  </ul>
                </nz-dropdown-menu>
              </div>
            </td>


            <nz-dropdown-menu #prospectionStatus>
              @for(status of prospectionStatuses ; track status){
              <ul nz-menu class="status-item">
                <div class="color-indicator" [style]="{'background-color': status.color}"></div>
                <li nz-menu-item (click)="setStatus(prospection, status.key)" >{{status.label}}</li>
              </ul>
              }
            </nz-dropdown-menu>


          </tr>
        </tbody>
      </nz-table>
    </div>
  </div>
</div>
